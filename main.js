!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_error",errorClass:"modal__error_visible"},r=(e,t,r)=>{const a=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),a.textContent=""},a=(e,t,a)=>{t.validity.valid?r(e,t,a):((e,t,r,a)=>{console.log(e);const n=e.querySelector(`#${t.id}-error`);t.classList.add(a.inputErrorClass),n.textContent=r})(e,t,t.validationMessage,a)},n=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled",!0)},o=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?n(t,r):(t.removeAttribute("disabled"),t.classList.remove(r.inactiveButtonClass))};function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?a:r}var d=e+"80804e27ce061efd1ffb.svg",c=e+"2fc47fd8e9a9bcd9612f.jpg",i=e+"3f562ce83766a824571e.svg",l=e+"d73f076c46eb5467f5fc.svg",u=e+"975792ea68af0a3c209d.svg";document.getElementById("logoSpots").src=d,document.getElementById("pencilImage").src=i,document.getElementById("avatarPencil").src=l,document.getElementById("plusIcon").src=u,document.getElementById("bessieAvatar").src=c;const m=document.querySelector("#edit-profile-modal"),_=document.querySelector(".profile__edit-btn"),v=document.querySelector(".profile__add-btn"),h=document.querySelector(".profile__avatar-btn"),f=document.querySelector(".profile__name"),S=document.querySelector(".profile__description"),y=document.querySelector(".profile__avatar"),b=m.querySelector(".modal__form"),p=m.querySelector(".modal__close"),q=m.querySelector("#profile-name-input"),L=m.querySelector("#profile-description-input"),E=document.querySelector("#add-card-modal"),g=E.querySelector(".modal__close"),k=E.querySelector(".modal__form"),C=E.querySelector(".modal__submit-btn"),I=(E.querySelector(".modal__submit-btn_disabled"),E.querySelector("#add-card-name-input")),U=E.querySelector("#add-card-link-input"),A=document.querySelector("#avatar-modal"),$=A.querySelector(".modal__close"),x=A.querySelector(".modal__form"),D=(A.querySelector(".modal__submit-btn"),A.querySelector("#profile-avatar-input")),B=document.querySelector("#delete-modal"),R=B.querySelector(".card__delete-form"),T=B.querySelector(".card__delete-form_close"),w=B.querySelector(".card__submit-btn_cancel"),P=document.querySelector("#preview-modal"),F=P.querySelector(".modal__image"),N=P.querySelector(".modal__caption"),j=P.querySelector(".modal__close_preview"),O=document.querySelector("#card-template"),J=document.querySelector(".cards__list");let G,H;I.addEventListener("input",(e=>a(k,I,t))),U.addEventListener("input",(e=>a(k,U,t)));const z=new class{constructor(e){let{baseURL:t,headers:r}=e;this._baseURL=t,this._headers=r}_checkresponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t){return fetch(e,t).then(this._checkresponse)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return this._request(`${this._baseURL}/cards`,{method:"GET",headers:this._headers})}getUserInfo(){return this._request(`${this._baseURL}/users/me`,{method:"GET",headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this._request(`${this._baseURL}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editAvatarInfo(e){return this._request(`${this._baseURL}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}addNewCard(e){let{name:t,link:r}=e;return this._request(`${this._baseURL}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this._request(`${this._baseURL}/cards/${e}`,{method:"DELETE",headers:this._headers})}handleLikeStatus(e,t){return this._request(`${this._baseURL}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({baseURL:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"ae624f98-22e3-40e2-ad55-6bf11082a736","Content-Type":"application/json"}});function M(e){const t=O.content.cloneNode(!0),r=t.querySelector(".card__title"),a=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),o=t.querySelector(".card__delete-btn");return e.isLiked&&n.classList.add("card__like-btn_liked"),r.textContent=e.name,a.src=e.link,a.alt=e.name,n.addEventListener("click",(t=>function(e,t){e.preventDefault();const r=!!e.target.closest(".card__like-btn_liked"),a=e.target.closest(".card__like-btn");z.handleLikeStatus(t,r).then((()=>{r?a.classList.remove("card__like-btn_liked"):a.classList.add("card__like-btn_liked")})).catch((e=>{console.error("Failed to fetch like data:",e)}))}(t,e._id))),o.addEventListener("click",(t=>function(e,t){G=e.target.closest(".card"),H=t,V(B)}(t,e._id))),a.addEventListener("click",(()=>function(e){F.src=e.link,N.textContent=e.name,F.alt=e.name,V(P)}(e))),t}function K(e){"Escape"===e.key&&W(document.querySelector(".modal_opened"))}function Q(e){e.target.classList.contains("modal_opened")&&W(e.target)}function V(e){e.classList.add("modal_opened"),e.addEventListener("click",Q),document.addEventListener("keydown",K)}function W(e){e.classList.remove("modal_opened"),e.removeEventListener("click",Q),document.removeEventListener("keydown",K)}var X;z.getAppInfo().then((e=>{let[t,{name:r,about:a,avatar:n}]=e;t.forEach((e=>{const t=M(e);J.append(t)})),f.textContent=r,S.textContent=a,y.src=n})).catch((e=>{console.error("Failed to fetch card data:",e)})),_.addEventListener("click",(()=>{var e,a;q.value=f.textContent,L.value=S.textContent,e=b,a=t,[q,L].forEach((t=>{r(e,t,a)})),V(m)})),p.addEventListener("click",(()=>{W(m)})),v.addEventListener("click",(()=>{V(E)})),h.addEventListener("click",(()=>{V(A)})),x.addEventListener("submit",(function(e){e.preventDefault(),z.editAvatarInfo(D.value).then((t=>{y.src=t.avatar,W(A),e.target.reset()})).catch((e=>{console.error("Failed to fetch avatar data:",e)}))})),$.addEventListener("click",(()=>{W(A)})),T.addEventListener("click",(()=>{W(B)})),R.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;s(t,!0,"Delete","Deleting..."),z.deleteCard(H).then((()=>{G.remove(),W(B)})).catch((e=>{console.error("Failed to fetch Card Id data:",e)})).finally((()=>{s(t,!1,"Delete","Deleting...")}))})),g.addEventListener("click",(()=>{W(E)})),j.addEventListener("click",(()=>{W(P)})),w.addEventListener("click",(()=>{W(B)})),b.addEventListener("submit",(function(e){e.preventDefault();const r=e.submitter;s(r,!0,"Save","Saving..."),z.editUserInfo({name:q.value,about:L.value}).then((e=>{f.textContent=e.name,S.textContent=e.about,W(m),n(r,t)})).catch((e=>{console.error("Failed to fetch form data:",e)})).finally((()=>{s(r,!1,"Save","Saving...")}))})),k.addEventListener("submit",(function(e){e.preventDefault();const r={name:I.value,link:U.value},a=e.submitter;return s(a,!0,"Save","Saving..."),z.addNewCard(r).then((r=>{const a=M(r);J.prepend(a),W(E),e.target.reset(),n(C,t)})).catch((e=>{console.error("Failed to fetch card data:",e)})).finally((()=>{s(a,!1,"Save","Saving...")}))})),X=t,Array.from(document.querySelectorAll(X.formSelector)).forEach((e=>{((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o(r,n,t),r.forEach((s=>{s.addEventListener("input",(function(){a(e,s,t),o(r,n,t)}))}))})(e,X)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2xFLEVBQW1CVCxFQUFRQyxFQUFTQyxHQUNwQ21CLEVBQWtCQyxFQUFXSCxFQUFXakIsRUFDMUMsR0FBRSxHQUNGLEVBS0E4SixDQUFrQmhLLEVBQVFFLEVBQU8sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCJleHBvcnQgY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcclxuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbn07XHJcblxyXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCBjb25maWcpID0+IHtcclxuICBjb25zb2xlLmxvZyhmb3JtRWwpO1xyXG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xyXG59O1xyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XHJcbiAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XHJcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsKSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWwudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSk7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKHN1Ym1pdEJ0biwgY29uZmlnKSA9PiB7XHJcbiAgc3VibWl0QnRuLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIHN1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxufTtcclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBzdWJtaXRCdG4sIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgZGlzYWJsZUJ1dHRvbihzdWJtaXRCdG4sIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHN1Ym1pdEJ0bi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcclxuICAgIHN1Ym1pdEJ0bi5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn07XHJcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgc3VibWl0QnRuLCBjb25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIHN1Ym1pdEJ0biwgY29uZmlnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59O1xyXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbn07XHJcbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdG5UZXh0KFxyXG4gIGJ0bixcclxuICBpc0xvYWRpbmcsXHJcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcclxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcclxuKSB7XHJcbiAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xyXG4gIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlU3VibWl0KHJlcXVlc3QsIGV2dCwgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiKSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBjb25zdCBpbml0aWFsVGV4dCA9IHN1Ym1pdEJ0bi50ZXh0Q29udGVudDtcclxuICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgaW5pdGlhbFRleHQsIGxvYWRpbmdUZXh0KTtcclxuICByZXF1ZXN0KClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgZmFsc2UsIGluaXRpYWxUZXh0KTtcclxuICAgIH0pO1xyXG59XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVVJMLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVUkwgPSBiYXNlVVJMO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG4gIF9jaGVja3Jlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcbiAgX3JlcXVlc3QodXJsLCBvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKHRoaXMuX2NoZWNrcmVzcG9uc2UpO1xyXG4gIH1cclxuICBnZXRBcHBJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVUkx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVSTH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVSTH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBhYm91dCxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuICB9XHJcbiAgZWRpdEF2YXRhckluZm8oYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVVJMfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG4gIH1cclxuICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVVJMfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVUkx9L2NhcmRzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVUkx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQXBpO1xyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQge1xyXG4gIGVuYWJsZVZhbGlkYXRpb24sXHJcbiAgcmVzZXRWYWxpZGF0aW9uLFxyXG4gIHZhbGlkYXRpb25Db25maWcsXHJcbiAgZGlzYWJsZUJ1dHRvbixcclxuICBjaGVja0lucHV0VmFsaWRpdHksXHJcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBzZXRCdG5UZXh0LCBoYW5kbGVTdWJtaXQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcclxuaW1wb3J0IGxvZ29TcG90cyBmcm9tIFwiLi4vaW1hZ2VzL2xvZ28uc3ZnXCI7XHJcbmltcG9ydCBiZXNzaWVBdmF0YXIgZnJvbSBcIi4uL2ltYWdlcy9hdmF0YXIuanBnXCI7XHJcbmltcG9ydCBwZW5jaWxJbWFnZSBmcm9tIFwiLi4vaW1hZ2VzL3BlbmNpbC5zdmdcIjtcclxuaW1wb3J0IGF2YXRhclBlbmNpbCBmcm9tIFwiLi4vaW1hZ2VzL3BlbmNpbC1saWdodC5zdmdcIjtcclxuaW1wb3J0IHBsdXNJY29uIGZyb20gXCIuLi9pbWFnZXMvcGx1cy5zdmdcIjtcclxuY29uc3Qgc3BvdHNJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9nb1Nwb3RzXCIpO1xyXG5zcG90c0ltYWdlLnNyYyA9IGxvZ29TcG90cztcclxuY29uc3QgcGVuY2lsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwZW5jaWxJbWFnZVwiKTtcclxucGVuY2lsLnNyYyA9IHBlbmNpbEltYWdlO1xyXG5jb25zdCBsaWdodFBlbmNpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZhdGFyUGVuY2lsXCIpO1xyXG5saWdodFBlbmNpbC5zcmMgPSBhdmF0YXJQZW5jaWw7XHJcbmNvbnN0IGFkZEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbHVzSWNvblwiKTtcclxuYWRkSW1hZ2Uuc3JjID0gcGx1c0ljb247XHJcbmNvbnN0IGJlc3NpZUltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZXNzaWVBdmF0YXJcIik7XHJcbmJlc3NpZUltYWdlLnNyYyA9IGJlc3NpZUF2YXRhcjtcclxuXHJcbmNvbnN0IGVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbmNvbnN0IGNhcmRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG5jb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcblxyXG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuXHJcbmNvbnN0IGVkaXRNb2RhbENsb3NlQnRuID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG5jb25zdCBlZGl0TW9kYWxOYW1lSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XHJcbmNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcclxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcclxuKTtcclxuXHJcbmNvbnN0IGNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XHJcblxyXG5jb25zdCBjYXJkTW9kYWxDbG9zZUJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZVwiKTtcclxuY29uc3QgY2FyZEZvcm0gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG5jb25zdCBkaXNhYmxlZEJ0bkVsID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIik7XHJcbmNvbnN0IGNhcmROYW1lSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1uYW1lLWlucHV0XCIpO1xyXG5jb25zdCBjYXJkTGlua0lucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiKTtcclxuXHJcbi8vQXZhdGFyIGZvcm0gZWxlbWVudHNcclxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWxDbG9zZUJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcclxuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xyXG5cclxuLy9EZWxldGUgRm9ybSBFbGVtZW50c1xyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtZm9ybVwiKTtcclxuY29uc3QgZGVsZXRlRm9ybUNsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcclxuICBcIi5jYXJkX19kZWxldGUtZm9ybV9jbG9zZVwiXHJcbik7XHJcbmNvbnN0IGNhbmNlbERlbGV0ZUJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fc3VibWl0LWJ0bl9jYW5jZWxcIik7XHJcblxyXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbEltZ0VsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxDYXB0aW9uRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcclxuY29uc3QgcHJldmlld0Nsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlX3ByZXZpZXdcIik7XHJcblxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XHJcbmNvbnN0IGNhcmRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcclxuXHJcbmxldCBzZWxlY3RlZENhcmQ7XHJcbmxldCBzZWxlY3RlZENhcmRJZDtcclxuXHJcbmNhcmROYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChldnQpID0+XHJcbiAgY2hlY2tJbnB1dFZhbGlkaXR5KGNhcmRGb3JtLCBjYXJkTmFtZUlucHV0LCB2YWxpZGF0aW9uQ29uZmlnKVxyXG4pO1xyXG5jYXJkTGlua0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZXZ0KSA9PlxyXG4gIGNoZWNrSW5wdXRWYWxpZGl0eShjYXJkRm9ybSwgY2FyZExpbmtJbnB1dCwgdmFsaWRhdGlvbkNvbmZpZylcclxuKTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVUkw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImFlNjI0Zjk4LTIyZTMtNDBlMi1hZDU1LTZiZjExMDgyYTczNlwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcclxuICBjb25zdCBjYXJkTmFtZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcclxuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xyXG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XHJcblxyXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcclxuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICB9XHJcblxyXG4gIGNhcmROYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xyXG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuXHJcbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IGhhbmRsZUxpa2UoZXZ0LCBkYXRhLl9pZCkpO1xyXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+XHJcbiAgICBoYW5kbGVEZWxldGVDYXJkKGV2dCwgZGF0YS5faWQpXHJcbiAgKTtcclxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlSW1hZ2VDbGljayhkYXRhKSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuYXBpXHJcbiAgLmdldEFwcEluZm8oKVxyXG4gIC50aGVuKChbY2FyZHMsIHsgbmFtZSwgYWJvdXQsIGF2YXRhciB9XSkgPT4ge1xyXG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xyXG4gICAgICBjYXJkTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBhYm91dDtcclxuICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjYXJkIGRhdGE6XCIsIGVycm9yKTtcclxuICB9KTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVzY0Nsb3NlKGV2dCkge1xyXG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICBjb25zdCBtb2RhbE9wZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGNsb3NlTW9kYWwobW9kYWxPcGVuKTtcclxuICB9XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlQ2xpY2tPdXRzaWRlKGV2dCkge1xyXG4gIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xyXG4gICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcclxuICB9XHJcbn1cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQ2xpY2tPdXRzaWRlKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XHJcbn1cclxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUNsaWNrT3V0c2lkZSk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjQ2xvc2UpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0Rm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ0blRleHQoc3VibWl0QnRuLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XHJcbiAgYXBpXHJcbiAgICAuZWRpdFVzZXJJbmZvKHtcclxuICAgICAgbmFtZTogZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlLFxyXG4gICAgICBhYm91dDogZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcclxuICAgICAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xyXG4gICAgICBkaXNhYmxlQnV0dG9uKHN1Ym1pdEJ0biwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGZvcm0gZGF0YTpcIiwgZXJyb3IpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2V0QnRuVGV4dChzdWJtaXRCdG4sIGZhbHNlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IGRhdGEgPSB7IG5hbWU6IGNhcmROYW1lSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ0blRleHQoc3VibWl0QnRuLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XHJcbiAgcmV0dXJuIGFwaVxyXG4gICAgLmFkZE5ld0NhcmQoZGF0YSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XHJcbiAgICAgIGNhcmRMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XHJcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcclxuICAgICAgZGlzYWJsZUJ1dHRvbihjYXJkU3VibWl0QnRuLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY2FyZCBkYXRhOlwiLCBlcnJvcik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdG5UZXh0KHN1Ym1pdEJ0biwgZmFsc2UsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgYXBpXHJcbiAgICAuZWRpdEF2YXRhckluZm8oYXZhdGFySW5wdXQudmFsdWUpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGRhdGEuYXZhdGFyO1xyXG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBhdmF0YXIgZGF0YTpcIiwgZXJyb3IpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoZXZ0LCBjYXJkSWQpIHtcclxuICBzZWxlY3RlZENhcmQgPSBldnQudGFyZ2V0LmNsb3Nlc3QoXCIuY2FyZFwiKTtcclxuICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcclxuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgZGVsZXRlQnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdG5UZXh0KGRlbGV0ZUJ0biwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBDYXJkIElkIGRhdGE6XCIsIGVycm9yKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldEJ0blRleHQoZGVsZXRlQnRuLCBmYWxzZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVMaWtlKGV2dCwgaWQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBpc0xpa2VkID0gISFldnQudGFyZ2V0LmNsb3Nlc3QoXCIuY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XHJcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBldnQudGFyZ2V0LmNsb3Nlc3QoXCIuY2FyZF9fbGlrZS1idG5cIik7XHJcbiAgYXBpXHJcbiAgICAuaGFuZGxlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgaWYgKCFpc0xpa2VkKSB7XHJcbiAgICAgICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBsaWtlIGRhdGE6XCIsIGVycm9yKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVJbWFnZUNsaWNrKGRhdGEpIHtcclxuICBwcmV2aWV3TW9kYWxJbWdFbC5zcmMgPSBkYXRhLmxpbms7XHJcbiAgcHJldmlld01vZGFsQ2FwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gIHByZXZpZXdNb2RhbEltZ0VsLmFsdCA9IGRhdGEubmFtZTtcclxuICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xyXG4gIHJlc2V0VmFsaWRhdGlvbihcclxuICAgIGVkaXRGb3JtRWxlbWVudCxcclxuICAgIFtlZGl0TW9kYWxOYW1lSW5wdXQsIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXRdLFxyXG4gICAgdmFsaWRhdGlvbkNvbmZpZ1xyXG4gICk7XHJcbiAgb3Blbk1vZGFsKGVkaXRNb2RhbCk7XHJcbn0pO1xyXG5cclxuZWRpdE1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XHJcbn0pO1xyXG5cclxuY2FyZE1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGNhcmRNb2RhbCk7XHJcbn0pO1xyXG5cclxuYXZhdGFyTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xyXG59KTtcclxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XHJcblxyXG5hdmF0YXJNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XHJcbn0pO1xyXG5cclxuZGVsZXRlRm9ybUNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbn0pO1xyXG5cclxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XHJcbmNhcmRNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xyXG59KTtcclxuXHJcbnByZXZpZXdDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwocHJldmlld01vZGFsKTtcclxufSk7XHJcblxyXG5jYW5jZWxEZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufSk7XHJcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcclxuY2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7XHJcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwiY29uZmlnIiwiZXJyb3JNc2dFbCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRleHRDb250ZW50IiwiY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJjb25zb2xlIiwibG9nIiwiYWRkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJkaXNhYmxlQnV0dG9uIiwic3VibWl0QnRuIiwic2V0QXR0cmlidXRlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJzb21lIiwiaGFzSW52YWxpZElucHV0IiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QnRuVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibG9hZGluZ1RleHQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwibG9nb1Nwb3RzIiwicGVuY2lsSW1hZ2UiLCJhdmF0YXJQZW5jaWwiLCJwbHVzSWNvbiIsImJlc3NpZUF2YXRhciIsImVkaXRNb2RhbCIsInByb2ZpbGVFZGl0QnRuIiwiY2FyZE1vZGFsQnRuIiwiYXZhdGFyTW9kYWxCdG4iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVBdmF0YXIiLCJlZGl0Rm9ybUVsZW1lbnQiLCJlZGl0TW9kYWxDbG9zZUJ0biIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJjYXJkTW9kYWwiLCJjYXJkTW9kYWxDbG9zZUJ0biIsImNhcmRGb3JtIiwiY2FyZFN1Ym1pdEJ0biIsImNhcmROYW1lSW5wdXQiLCJjYXJkTGlua0lucHV0IiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJNb2RhbENsb3NlQnRuIiwiYXZhdGFyRm9ybSIsImF2YXRhcklucHV0IiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwiZGVsZXRlRm9ybUNsb3NlQnRuIiwiY2FuY2VsRGVsZXRlQnRuIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1nRWwiLCJwcmV2aWV3TW9kYWxDYXB0aW9uRWwiLCJwcmV2aWV3Q2xvc2VCdG4iLCJjYXJkVGVtcGxhdGUiLCJjYXJkTGlzdCIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsImFwaSIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVUkwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVVJMIiwiX2hlYWRlcnMiLCJfY2hlY2tyZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfcmVxdWVzdCIsInVybCIsIm9wdGlvbnMiLCJmZXRjaCIsInRoZW4iLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJtZXRob2QiLCJlZGl0VXNlckluZm8iLCJfcmVmMiIsIm5hbWUiLCJhYm91dCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJhZGROZXdDYXJkIiwiX3JlZjMiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImhhbmRsZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmROYW1lRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsImFsdCIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwiY2xvc2VzdCIsImNhdGNoIiwiZXJyb3IiLCJoYW5kbGVMaWtlIiwiX2lkIiwiY2FyZElkIiwib3Blbk1vZGFsIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVFc2NDbG9zZSIsImtleSIsImNsb3NlTW9kYWwiLCJoYW5kbGVDbGlja091dHNpZGUiLCJjb250YWlucyIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNhcmRzIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmQiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsInJlc2V0IiwiZGVsZXRlQnRuIiwic3VibWl0dGVyIiwiZmluYWxseSIsInByZXBlbmQiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwic2V0RXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9