!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_error",errorClass:"modal__error_visible"},r=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent=""},o=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?((e,t)=>{e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled",!0)})(t,r):(t.removeAttribute("disabled"),t.classList.remove(r.inactiveButtonClass))};function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?o:r}var a=e+"80804e27ce061efd1ffb.svg",s=e+"2fc47fd8e9a9bcd9612f.jpg",c=e+"3f562ce83766a824571e.svg",l=e+"d73f076c46eb5467f5fc.svg",d=e+"975792ea68af0a3c209d.svg";document.getElementById("logoSpots").src=a,document.getElementById("pencilImage").src=c,document.getElementById("avatarPencil").src=l,document.getElementById("plusIcon").src=d,document.getElementById("bessieAvatar").src=s;const i=document.querySelector("#edit-profile-modal"),u=document.querySelector(".profile__edit-btn"),m=document.querySelector(".profile__add-btn"),_=document.querySelector(".profile__avatar-btn"),v=document.querySelector(".profile__name"),f=document.querySelector(".profile__description"),h=document.querySelector(".profile__avatar"),b=i.querySelector(".modal__form"),y=i.querySelector(".modal__close"),p=i.querySelector("#profile-name-input"),S=i.querySelector("#profile-description-input"),g=document.querySelector("#add-card-modal"),E=g.querySelector(".modal__close"),L=g.querySelector(".modal__form"),k=g.querySelector(".modal__submit-btn"),q=(g.querySelector(".modal__submit-btn_disabled"),g.querySelector("#add-card-name-input")),C=g.querySelector("#add-card-link-input"),I=document.querySelector("#avatar-modal"),$=I.querySelector(".modal__close"),A=I.querySelector(".modal__form"),j=(I.querySelector(".modal__submit-btn"),I.querySelector("#profile-avatar-input")),U=document.querySelector("#delete-modal"),P=U.querySelector(".card__delete-form"),x=U.querySelector(".card__delete-form_close"),D=U.querySelector(".card__submit-btn_cancel"),B=document.querySelector("#preview-modal"),R=B.querySelector(".modal__image"),T=B.querySelector(".modal__caption"),w=B.querySelector(".modal__close_preview"),N=document.querySelector("#card-template"),O=document.querySelector(".cards__list");let J,G;q.addEventListener("input",Q),C.addEventListener("input",Q);const H=new class{constructor(e){let{baseURL:t,headers:r}=e;this._baseURL=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseURL}/cards`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseURL}/users/me`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseURL}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editAvatarInfo(e){return fetch(`${this._baseURL}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addNewCard(e){let{name:t,link:r}=e;return fetch(`${this._baseURL}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}deleteCard(e){return fetch(`${this._baseURL}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}handleLikeStatus(e,t){return fetch(`${this._baseURL}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseURL:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"ccc1108b-0e43-4488-be9b-8eb1c8ff494e","Content-Type":"application/json"}});function z(e){"Escape"===e.key&&K(document.querySelector(".modal_opened"))}function M(e){e.target.classList.contains("modal_opened")&&K(e.target)}function F(e){e.classList.add("modal_opened"),e.addEventListener("click",M),document.addEventListener("keydown",z)}function K(e){e.classList.remove("modal_opened"),e.removeEventListener("click",M),document.removeEventListener("keydown",z)}function Q(e){""!=q.value&&""!=C.value?(k.disabled=!1,k.classList.remove("modal__submit-btn_disabled")):(k.classList.add("modal__submit-btn_disabled"),k.disabled=!0)}function V(e){const t=N.content.cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return e.isLiked&&n.classList.add("card__like-btn_liked"),r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(t=>function(e,t){e.preventDefault();const r=!!e.target.closest(".card__like-btn_liked"),o=e.target.closest(".card__like-btn");H.handleLikeStatus(t,r).then((()=>{r?o.classList.remove("card__like-btn_liked"):o.classList.add("card__like-btn_liked")})).catch(console.error)}(t,e._id))),console.log(e._id),a.addEventListener("click",(t=>function(e,t){J=e.target.closest(".card"),G=t,console.log(t),F(U)}(t,e._id))),o.addEventListener("click",(()=>function(e){R.src=e.link,T.textContent=e.name,R.alt=e.name,F(B)}(e))),t}var W;H.getAppInfo().then((e=>{let[t,{name:r,about:o,avatar:n}]=e;console.log(t),t.forEach((e=>{const t=V(e);O.append(t)})),v.textContent=r,f.textContent=o,h.src=n})).catch(console.error),console.log("API instance created:",H),console.log("getAppInfo method exists:",typeof H.getAppInfo),u.addEventListener("click",(()=>{var e,o;p.value=v.textContent,S.value=f.textContent,e=b,o=t,[p,S].forEach((t=>{r(e,t,o)})),F(i)})),y.addEventListener("click",(()=>{K(i)})),m.addEventListener("click",(()=>{F(g),Q()})),_.addEventListener("click",(()=>{F(I)})),A.addEventListener("submit",(function(e){e.preventDefault(),console.log(j.value),H.editAvatarInfo(j.value).then((e=>{console.log(e),K(I)})).catch(console.error)})),$.addEventListener("click",(()=>{K(I)})),x.addEventListener("click",(()=>{K(U)})),P.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;n(t,!0,"Delete","Deleting..."),console.log("selectedCard:",J),console.log("Type of selectedCard:",typeof J),console.log(G),console.log("About to delete card with ID:",G),H.deleteCard(G).then((()=>{J.remove(),K(U)})).catch(console.error).finally((()=>{n(t,!1,"Delete","Deleting...")}))})),E.addEventListener("click",(()=>{K(g)})),w.addEventListener("click",(()=>{K(B)})),D.addEventListener("click",(()=>{K(U)})),b.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;n(t,!0,"Save","Saving..."),H.editUserInfo({name:p.value,about:S.value}).then((e=>{v.textContent=e.name,f.textContent=e.about,K(i)})).catch(console.error).finally((()=>{n(t,!1,"Save","Saving...")}))})),L.addEventListener("submit",(function(e){e.preventDefault(),console.log(q.value),console.log(C.value);const t={name:q.value,link:C.value};H.addNewCard(t).then((t=>{const r=V(t);O.prepend(r),K(g),e.target.reset(),Q()})).catch(console.error)})),W=t,Array.from(document.querySelectorAll(W.formSelector)).forEach((e=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o(n,a,t),n.forEach((s=>{s.addEventListener("input",(function(){((e,t,o)=>{t.validity.valid?r(e,t,o):((e,t,r,o)=>{console.log(e);const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r})(e,t,t.validationMessage,o)})(e,s,t),o(n,a,t)}))}))})(e,W)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEdBRXhDUSxFQUFVbUksU0FBUzVJLElBQ2pCQSxFQUFRb0UsaUJBQWlCLFNBQVMsV0FyQ1hxRixFQUFDMUosRUFBUUMsRUFBU0MsS0FDdENELEVBQVFZLFNBQVNDLE1BR3BCZixFQUFlQyxFQUFRQyxFQUFTQyxHQWhCYnlKLEVBQUMzSixFQUFRQyxFQUFTMkosRUFBVTFKLEtBQ2pEa0ksUUFBUUksSUFBSXhJLEdBQ1osTUFBTUcsRUFBYUgsRUFBT0ksY0FBYyxJQUFJSCxFQUFRSSxZQUNwREosRUFBUUssVUFBVVcsSUFBSWYsRUFBT0wsaUJBQzdCTSxFQUFXSyxZQUFjb0osQ0FBUSxFQVUvQkQsQ0FBZTNKLEVBQVFDLEVBQVNBLEVBQVE0SixrQkFBbUIzSixFQUc3RCxFQWlDSXdKLENBQW1CMUosRUFBUUMsRUFBU0MsR0FDcENPLEVBQWtCQyxFQUFXQyxFQUFXVCxFQUMxQyxHQUFFLEdBQ0YsRUFLQXVKLENBQWtCekosRUFBUUUsRUFBTyxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiOyIsImV4cG9ydCBjb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF9lcnJvclwiLFxyXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcclxufTtcclxuXHJcbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGZvcm1FbCk7XHJcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XHJcbn07XHJcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xyXG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkO1xyXG4gIH0pO1xyXG59O1xyXG5jb25zdCBkaXNhYmxlQnV0dG9uID0gKHN1Ym1pdEJ0biwgY29uZmlnKSA9PiB7XHJcbiAgc3VibWl0QnRuLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIHN1Ym1pdEJ0bi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxufTtcclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBzdWJtaXRCdG4sIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgZGlzYWJsZUJ1dHRvbihzdWJtaXRCdG4sIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHN1Ym1pdEJ0bi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcclxuICAgIHN1Ym1pdEJ0bi5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn07XHJcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgc3VibWl0QnRuLCBjb25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xyXG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIHN1Ym1pdEJ0biwgY29uZmlnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59O1xyXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbn07XHJcbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdG5UZXh0KFxyXG4gIGJ0bixcclxuICBpc0xvYWRpbmcsXHJcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcclxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcclxuKSB7XHJcbiAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xyXG4gIH1cclxufVxyXG4iLCJjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVSTCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVVJMID0gYmFzZVVSTDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgZ2V0QXBwSW5mbygpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVSTH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVVJMfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVVJMfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVUkx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhdmF0YXIsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVUkx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVSTH0vY2FyZHMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVMaWtlU3RhdHVzKGlkLCBpc0xpa2VkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVSTH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XHJcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHtcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG4gIHJlc2V0VmFsaWRhdGlvbixcclxuICB2YWxpZGF0aW9uQ29uZmlnLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IHsgc2V0QnRuVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5pbXBvcnQgbG9nb1Nwb3RzIGZyb20gXCIuLi9pbWFnZXMvbG9nby5zdmdcIjtcclxuaW1wb3J0IGJlc3NpZUF2YXRhciBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcclxuaW1wb3J0IHBlbmNpbEltYWdlIGZyb20gXCIuLi9pbWFnZXMvcGVuY2lsLnN2Z1wiO1xyXG5pbXBvcnQgYXZhdGFyUGVuY2lsIGZyb20gXCIuLi9pbWFnZXMvcGVuY2lsLWxpZ2h0LnN2Z1wiO1xyXG5pbXBvcnQgcGx1c0ljb24gZnJvbSBcIi4uL2ltYWdlcy9wbHVzLnN2Z1wiO1xyXG5jb25zdCBzcG90c0ltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2dvU3BvdHNcIik7XHJcbnNwb3RzSW1hZ2Uuc3JjID0gbG9nb1Nwb3RzO1xyXG5jb25zdCBwZW5jaWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBlbmNpbEltYWdlXCIpO1xyXG5wZW5jaWwuc3JjID0gcGVuY2lsSW1hZ2U7XHJcbmNvbnN0IGxpZ2h0UGVuY2lsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhdmF0YXJQZW5jaWxcIik7XHJcbmxpZ2h0UGVuY2lsLnNyYyA9IGF2YXRhclBlbmNpbDtcclxuY29uc3QgYWRkSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsdXNJY29uXCIpO1xyXG5hZGRJbWFnZS5zcmMgPSBwbHVzSWNvbjtcclxuY29uc3QgYmVzc2llSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJlc3NpZUF2YXRhclwiKTtcclxuYmVzc2llSW1hZ2Uuc3JjID0gYmVzc2llQXZhdGFyO1xyXG5cclxuY29uc3QgZWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcclxuY29uc3QgY2FyZE1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcclxuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XHJcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuXHJcbmNvbnN0IGVkaXRGb3JtRWxlbWVudCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5cclxuY29uc3QgZWRpdE1vZGFsQ2xvc2VCdG4gPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XHJcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxyXG4pO1xyXG5cclxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcclxuXHJcbmNvbnN0IGNhcmRNb2RhbENsb3NlQnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG5jb25zdCBjYXJkRm9ybSA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBjYXJkU3VibWl0QnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XHJcbmNvbnN0IGRpc2FibGVkQnRuRWwgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiKTtcclxuY29uc3QgY2FyZE5hbWVJbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW5hbWUtaW5wdXRcIik7XHJcbmNvbnN0IGNhcmRMaW5rSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xyXG5cclxuLy9BdmF0YXIgZm9ybSBlbGVtZW50c1xyXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XHJcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJTdWJtaXRCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XHJcblxyXG4vL0RlbGV0ZSBGb3JtIEVsZW1lbnRzXHJcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XHJcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1mb3JtXCIpO1xyXG5jb25zdCBkZWxldGVGb3JtQ2xvc2VCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLmNhcmRfX2RlbGV0ZS1mb3JtX2Nsb3NlXCJcclxuKTtcclxuY29uc3QgY2FuY2VsRGVsZXRlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5jYXJkX19zdWJtaXQtYnRuX2NhbmNlbFwiKTtcclxuXHJcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcclxuY29uc3QgcHJldmlld01vZGFsSW1nRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5jb25zdCBwcmV2aWV3Q2xvc2VCdG4gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VfcHJldmlld1wiKTtcclxuXHJcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcclxuY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xyXG5cclxubGV0IHNlbGVjdGVkQ2FyZDtcclxubGV0IHNlbGVjdGVkQ2FyZElkO1xyXG5cclxuY2FyZE5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZGlzYWJsZUJ1dHRvbik7XHJcbmNhcmRMaW5rSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGRpc2FibGVCdXR0b24pO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVSTDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiY2NjMTEwOGItMGU0My00NDg4LWJlOWItOGViMWM4ZmY0OTRlXCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbmFwaVxyXG4gIC5nZXRBcHBJbmZvKClcclxuICAudGhlbigoW2NhcmRzLCB7IG5hbWUsIGFib3V0LCBhdmF0YXIgfV0pID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGNhcmRzKTtcclxuICAgIGNhcmRzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcclxuICAgICAgY2FyZExpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgIH0pO1xyXG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gYWJvdXQ7XHJcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGF2YXRhcjtcclxuICB9KVxyXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuXHJcbmNvbnNvbGUubG9nKFwiQVBJIGluc3RhbmNlIGNyZWF0ZWQ6XCIsIGFwaSk7XHJcbmNvbnNvbGUubG9nKFwiZ2V0QXBwSW5mbyBtZXRob2QgZXhpc3RzOlwiLCB0eXBlb2YgYXBpLmdldEFwcEluZm8pO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgIGNvbnN0IG1vZGFsT3BlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgY2xvc2VNb2RhbChtb2RhbE9wZW4pO1xyXG4gIH1cclxufVxyXG5mdW5jdGlvbiBoYW5kbGVDbGlja091dHNpZGUoZXZ0KSB7XHJcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfb3BlbmVkXCIpKSB7XHJcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xyXG4gIH1cclxufVxyXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVDbGlja091dHNpZGUpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcclxufVxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQ2xpY2tPdXRzaWRlKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRpc2FibGVCdXR0b24oZXZ0KSB7XHJcbiAgaWYgKGNhcmROYW1lSW5wdXQudmFsdWUgIT0gXCJcIiAmJiBjYXJkTGlua0lucHV0LnZhbHVlICE9IFwiXCIpIHtcclxuICAgIGNhcmRTdWJtaXRCdG4uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGNhcmRTdWJtaXRCdG4uY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjYXJkU3VibWl0QnRuLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiKTtcclxuICAgIGNhcmRTdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnRuVGV4dChzdWJtaXRCdG4sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcclxuICBhcGlcclxuICAgIC5lZGl0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsXHJcbiAgICAgIGFib3V0OiBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xyXG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldEJ0blRleHQoc3VibWl0QnRuLCBmYWxzZSwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zb2xlLmxvZyhjYXJkTmFtZUlucHV0LnZhbHVlKTtcclxuICBjb25zb2xlLmxvZyhjYXJkTGlua0lucHV0LnZhbHVlKTtcclxuICBjb25zdCBkYXRhID0geyBuYW1lOiBjYXJkTmFtZUlucHV0LnZhbHVlLCBsaW5rOiBjYXJkTGlua0lucHV0LnZhbHVlIH07XHJcblxyXG4gIGFwaVxyXG4gICAgLmFkZE5ld0NhcmQoZGF0YSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XHJcbiAgICAgIGNhcmRMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XHJcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcclxuICAgICAgZGlzYWJsZUJ1dHRvbigpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxufVxyXG5cclxuLy9UT0RPLSBGaW5pc2ggYXZhdGFyIHN1Ym1pc3Npb24gaGFuZGxlclxyXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc29sZS5sb2coYXZhdGFySW5wdXQudmFsdWUpO1xyXG4gIGFwaVxyXG4gICAgLmVkaXRBdmF0YXJJbmZvKGF2YXRhcklucHV0LnZhbHVlKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgIC8vIFRPRE8gLSBtYWtlIHRoaXMgd29ya1xyXG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbn1cclxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGNhcmROYW1lRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XHJcbiAgY29uc3QgY2FyZERlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcclxuXHJcbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xyXG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xyXG4gIH1cclxuXHJcbiAgY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICBjYXJkSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XHJcbiAgY2FyZEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xyXG5cclxuICBjYXJkTGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZShldnQsIGRhdGEuX2lkKSk7XHJcbiAgY29uc29sZS5sb2coZGF0YS5faWQpO1xyXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+XHJcbiAgICBoYW5kbGVEZWxldGVDYXJkKGV2dCwgZGF0YS5faWQpXHJcbiAgKTtcclxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlSW1hZ2VDbGljayhkYXRhKSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChldnQsIGNhcmRJZCkge1xyXG4gIHNlbGVjdGVkQ2FyZCA9IGV2dC50YXJnZXQuY2xvc2VzdChcIi5jYXJkXCIpO1xyXG4gIHNlbGVjdGVkQ2FyZElkID0gY2FyZElkO1xyXG4gIGNvbnNvbGUubG9nKGNhcmRJZCk7XHJcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IGRlbGV0ZUJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnRuVGV4dChkZWxldGVCdG4sIHRydWUsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcblxyXG4gIGNvbnNvbGUubG9nKFwic2VsZWN0ZWRDYXJkOlwiLCBzZWxlY3RlZENhcmQpO1xyXG4gIGNvbnNvbGUubG9nKFwiVHlwZSBvZiBzZWxlY3RlZENhcmQ6XCIsIHR5cGVvZiBzZWxlY3RlZENhcmQpO1xyXG4gIGNvbnNvbGUubG9nKHNlbGVjdGVkQ2FyZElkKTtcclxuICBjb25zb2xlLmxvZyhcIkFib3V0IHRvIGRlbGV0ZSBjYXJkIHdpdGggSUQ6XCIsIHNlbGVjdGVkQ2FyZElkKTtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdG5UZXh0KGRlbGV0ZUJ0biwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGlkKSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgaXNMaWtlZCA9ICEhZXZ0LnRhcmdldC5jbG9zZXN0KFwiLmNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gZXZ0LnRhcmdldC5jbG9zZXN0KFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xyXG4gIGFwaVxyXG4gICAgLmhhbmRsZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGlmICghaXNMaWtlZCkge1xyXG4gICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2soZGF0YSkge1xyXG4gIHByZXZpZXdNb2RhbEltZ0VsLnNyYyA9IGRhdGEubGluaztcclxuICBwcmV2aWV3TW9kYWxDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgcHJldmlld01vZGFsSW1nRWwuYWx0ID0gZGF0YS5uYW1lO1xyXG4gIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xyXG59XHJcblxyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgZWRpdEZvcm1FbGVtZW50LFxyXG4gICAgW2VkaXRNb2RhbE5hbWVJbnB1dCwgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dF0sXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnXHJcbiAgKTtcclxuICBvcGVuTW9kYWwoZWRpdE1vZGFsKTtcclxufSk7XHJcblxyXG5lZGl0TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcclxufSk7XHJcblxyXG5jYXJkTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBvcGVuTW9kYWwoY2FyZE1vZGFsKTtcclxuICBkaXNhYmxlQnV0dG9uKCk7XHJcbn0pO1xyXG5cclxuLy9UT0RPIC0gc2VsZWN0IGF2YXRhciBtb2RhbCBidXR0b24gYXQgdG9wIG9mIHRoZSBwYWdlXHJcbmF2YXRhck1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcclxufSk7XHJcbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xyXG5cclxuYXZhdGFyTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xyXG59KTtcclxuXHJcbmRlbGV0ZUZvcm1DbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xyXG5jYXJkTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoY2FyZE1vZGFsKTtcclxufSk7XHJcblxyXG5wcmV2aWV3Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbn0pO1xyXG5cclxuY2FuY2VsRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbn0pO1xyXG5lZGl0Rm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XHJcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xyXG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yTXNnRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0Iiwic3VibWl0QnRuIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiYWRkIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QnRuVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibG9hZGluZ1RleHQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3JjIiwibG9nb1Nwb3RzIiwicGVuY2lsSW1hZ2UiLCJhdmF0YXJQZW5jaWwiLCJwbHVzSWNvbiIsImJlc3NpZUF2YXRhciIsImVkaXRNb2RhbCIsInByb2ZpbGVFZGl0QnRuIiwiY2FyZE1vZGFsQnRuIiwiYXZhdGFyTW9kYWxCdG4iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVBdmF0YXIiLCJlZGl0Rm9ybUVsZW1lbnQiLCJlZGl0TW9kYWxDbG9zZUJ0biIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJjYXJkTW9kYWwiLCJjYXJkTW9kYWxDbG9zZUJ0biIsImNhcmRGb3JtIiwiY2FyZFN1Ym1pdEJ0biIsImNhcmROYW1lSW5wdXQiLCJjYXJkTGlua0lucHV0IiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJNb2RhbENsb3NlQnRuIiwiYXZhdGFyRm9ybSIsImF2YXRhcklucHV0IiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwiZGVsZXRlRm9ybUNsb3NlQnRuIiwiY2FuY2VsRGVsZXRlQnRuIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1nRWwiLCJwcmV2aWV3TW9kYWxDYXB0aW9uRWwiLCJwcmV2aWV3Q2xvc2VCdG4iLCJjYXJkVGVtcGxhdGUiLCJjYXJkTGlzdCIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFwaSIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVUkwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVVJMIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJuYW1lIiwiYWJvdXQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiYWRkTmV3Q2FyZCIsIl9yZWYzIiwibGluayIsImRlbGV0ZUNhcmQiLCJoYW5kbGVMaWtlU3RhdHVzIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVFc2NDbG9zZSIsImV2dCIsImtleSIsImNsb3NlTW9kYWwiLCJoYW5kbGVDbGlja091dHNpZGUiLCJ0YXJnZXQiLCJjb250YWlucyIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInZhbHVlIiwiZGlzYWJsZWQiLCJnZXRDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkTmFtZUVsIiwiY2FyZEltYWdlRWwiLCJjYXJkTGlrZUJ0biIsImNhcmREZWxldGVCdG4iLCJhbHQiLCJwcmV2ZW50RGVmYXVsdCIsImNsb3Nlc3QiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImhhbmRsZUxpa2UiLCJfaWQiLCJsb2ciLCJjYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiaGFuZGxlSW1hZ2VDbGljayIsImNhcmRzIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmQiLCJyZXNldFZhbGlkYXRpb24iLCJkZWxldGVCdG4iLCJzdWJtaXR0ZXIiLCJmaW5hbGx5IiwicHJlcGVuZCIsInJlc2V0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==